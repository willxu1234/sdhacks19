{"ast":null,"code":"var AWS = require('../core');\n\nvar regionConfig = require('../region_config');\n\nvar ENV_REGIONAL_ENDPOINT_ENABLED = 'AWS_STS_REGIONAL_ENDPOINTS';\nvar CONFIG_REGIONAL_ENDPOINT_ENABLED = 'sts_regional_endpoints';\nAWS.util.update(AWS.STS.prototype, {\n  /**\n   * @overload credentialsFrom(data, credentials = null)\n   *   Creates a credentials object from STS response data containing\n   *   credentials information. Useful for quickly setting AWS credentials.\n   *\n   *   @note This is a low-level utility function. If you want to load temporary\n   *     credentials into your process for subsequent requests to AWS resources,\n   *     you should use {AWS.TemporaryCredentials} instead.\n   *   @param data [map] data retrieved from a call to {getFederatedToken},\n   *     {getSessionToken}, {assumeRole}, or {assumeRoleWithWebIdentity}.\n   *   @param credentials [AWS.Credentials] an optional credentials object to\n   *     fill instead of creating a new object. Useful when modifying an\n   *     existing credentials object from a refresh call.\n   *   @return [AWS.TemporaryCredentials] the set of temporary credentials\n   *     loaded from a raw STS operation response.\n   *   @example Using credentialsFrom to load global AWS credentials\n   *     var sts = new AWS.STS();\n   *     sts.getSessionToken(function (err, data) {\n   *       if (err) console.log(\"Error getting credentials\");\n   *       else {\n   *         AWS.config.credentials = sts.credentialsFrom(data);\n   *       }\n   *     });\n   *   @see AWS.TemporaryCredentials\n   */\n  credentialsFrom: function credentialsFrom(data, credentials) {\n    if (!data) return null;\n    if (!credentials) credentials = new AWS.TemporaryCredentials();\n    credentials.expired = false;\n    credentials.accessKeyId = data.Credentials.AccessKeyId;\n    credentials.secretAccessKey = data.Credentials.SecretAccessKey;\n    credentials.sessionToken = data.Credentials.SessionToken;\n    credentials.expireTime = data.Credentials.Expiration;\n    return credentials;\n  },\n  assumeRoleWithWebIdentity: function assumeRoleWithWebIdentity(params, callback) {\n    return this.makeUnauthenticatedRequest('assumeRoleWithWebIdentity', params, callback);\n  },\n  assumeRoleWithSAML: function assumeRoleWithSAML(params, callback) {\n    return this.makeUnauthenticatedRequest('assumeRoleWithSAML', params, callback);\n  },\n\n  /**\n   * @api private\n   */\n  validateRegionalEndpointsFlagValue: function validateRegionalEndpointsFlagValue(configValue, errorOptions) {\n    if (typeof configValue === 'string' && ['legacy', 'regional'].indexOf(configValue.toLowerCase()) >= 0) {\n      this.config.stsRegionalEndpoints = configValue.toLowerCase();\n      return;\n    } else {\n      throw AWS.util.error(new Error(), errorOptions);\n    }\n  },\n\n  /**\n   * @api private\n   */\n  validateRegionalEndpointsFlag: function validateRegionalEndpointsFlag() {\n    //validate config value\n    var config = this.config;\n\n    if (config.stsRegionalEndpoints) {\n      this.validateRegionalEndpointsFlagValue(config.stsRegionalEndpoints, {\n        code: 'InvalidConfiguration',\n        message: 'invalid \"stsRegionalEndpoints\" configuration. Expect \"legacy\" ' + ' or \"regional\". Got \"' + config.stsRegionalEndpoints + '\".'\n      });\n    }\n\n    if (!AWS.util.isNode()) return; //validate environmental variable\n\n    if (Object.prototype.hasOwnProperty.call(process.env, ENV_REGIONAL_ENDPOINT_ENABLED)) {\n      var envFlag = process.env[ENV_REGIONAL_ENDPOINT_ENABLED];\n      this.validateRegionalEndpointsFlagValue(envFlag, {\n        code: 'InvalidEnvironmentalVariable',\n        message: 'invalid ' + ENV_REGIONAL_ENDPOINT_ENABLED + ' environmental variable. Expect \"legacy\" ' + ' or \"regional\". Got \"' + process.env[ENV_REGIONAL_ENDPOINT_ENABLED] + '\".'\n      });\n    } //validate shared config file\n\n\n    var profile = {};\n\n    try {\n      var profiles = AWS.util.getProfilesFromSharedConfig(AWS.util.iniLoader);\n      profile = profiles[process.env.AWS_PROFILE || AWS.util.defaultProfile];\n    } catch (e) {}\n\n    ;\n\n    if (profile && Object.prototype.hasOwnProperty.call(profile, CONFIG_REGIONAL_ENDPOINT_ENABLED)) {\n      var fileFlag = profile[CONFIG_REGIONAL_ENDPOINT_ENABLED];\n      this.validateRegionalEndpointsFlagValue(fileFlag, {\n        code: 'InvalidConfiguration',\n        message: 'invalid ' + CONFIG_REGIONAL_ENDPOINT_ENABLED + ' profile config. Expect \"legacy\" ' + ' or \"regional\". Got \"' + profile[CONFIG_REGIONAL_ENDPOINT_ENABLED] + '\".'\n      });\n    }\n  },\n\n  /**\n   * @api private\n   */\n  optInRegionalEndpoint: function optInRegionalEndpoint() {\n    this.validateRegionalEndpointsFlag();\n    var config = this.config;\n\n    if (config.stsRegionalEndpoints === 'regional') {\n      regionConfig(this);\n      if (!this.isGlobalEndpoint) return;\n      this.isGlobalEndpoint = false; //client will throw if region is not supplied; request will be signed with specified region\n\n      if (!config.region) {\n        throw AWS.util.error(new Error(), {\n          code: 'ConfigError',\n          message: 'Missing region in config'\n        });\n      }\n\n      var insertPoint = config.endpoint.indexOf('.amazonaws.com');\n      config.endpoint = config.endpoint.substring(0, insertPoint) + '.' + config.region + config.endpoint.substring(insertPoint);\n    }\n  },\n  validateService: function validateService() {\n    this.optInRegionalEndpoint();\n  }\n});","map":null,"metadata":{},"sourceType":"script"}